# QUICK START GUIDE - Cloud Connect Backup Manager
# Production Deployment in 10 Minutes

## Prerequisites (VERIFY FIRST)
- Ubuntu 20.04+ / Debian 11+ / RHEL 8+ server
- Root or sudo access
- Public IP address
- Domain name pointed to your server
- 4GB RAM minimum
- 20GB disk space

## STEP 1: INSTALL DEPENDENCIES (5 minutes)

### Install Docker
```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
newgrp docker
```

### Install Docker Compose
```bash
sudo curl -L "https://github.com/docker/compose/releases/download/v2.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### Verify Installation
```bash
docker --version
# Output: Docker version 24.0.7

docker-compose --version
# Output: Docker Compose version v2.24.0
```

## STEP 2: EXTRACT AND SETUP (2 minutes)

```bash
# Extract deployment package
tar -xzf cloud-connect-backup-manager-v1.0-production.tar.gz
cd backup-manager

# Run automated deployment script
chmod +x deploy.sh
./deploy.sh
```

**What this does:**
- Generates 256-bit AES encryption key
- Creates 512-bit JWT secret
- Sets up PostgreSQL with encryption
- Configures Redis for session storage
- Creates self-signed SSL certificates
- Builds all required configuration files

## STEP 3: CONFIGURE PRODUCTION SETTINGS (2 minutes)

Edit the `.env` file:
```bash
nano .env
```

**REQUIRED CHANGES:**
```bash
# Replace with your actual domain
FRONTEND_URL=https://backups.cloudconnect.com
API_URL=https://api.backups.cloudconnect.com

# Add Google Analytics (Get from: https://analytics.google.com)
GA_MEASUREMENT_ID=G-XXXXXXXXXX

# Add Google Tag Manager (Get from: https://tagmanager.google.com)  
GTM_ID=GTM-XXXXXXX

# Keep these auto-generated (DO NOT CHANGE)
JWT_SECRET=<auto-generated-do-not-change>
ENCRYPTION_KEY=<auto-generated-do-not-change>
POSTGRES_PASSWORD=<auto-generated-do-not-change>
REDIS_PASSWORD=<auto-generated-do-not-change>
```

**Save and exit:** Ctrl+X, Y, Enter

## STEP 4: INSTALL SSL CERTIFICATES (1 minute)

### Option A: Let's Encrypt (FREE - Recommended for Production)
```bash
# Install Certbot
sudo apt-get update
sudo apt-get install -y certbot

# Stop services temporarily
./stop.sh

# Get certificate (replace with your domain)
sudo certbot certonly --standalone \
  -d backups.cloudconnect.com \
  -d api.backups.cloudconnect.com \
  --email admin@cloudconnect.com \
  --agree-tos \
  --non-interactive

# Copy certificates
sudo cp /etc/letsencrypt/live/backups.cloudconnect.com/fullchain.pem nginx/ssl/cert.pem
sudo cp /etc/letsencrypt/live/backups.cloudconnect.com/privkey.pem nginx/ssl/key.pem
sudo chown $USER:$USER nginx/ssl/*.pem
```

### Option B: Use Self-Signed (Development Only)
```bash
# Already created by deploy.sh - skip this step
```

## STEP 5: DEPLOY APPLICATION (<1 minute)

```bash
# Start all services
./start.sh

# Wait for services to initialize (30-60 seconds)
sleep 60

# Verify all services are running
docker-compose ps
```

**Expected Output:**
```
NAME                        STATUS
backup-manager-backend      Up (healthy)
backup-manager-db           Up (healthy)  
backup-manager-frontend     Up (healthy)
backup-manager-redis        Up (healthy)
```

## STEP 6: VERIFY DEPLOYMENT (<1 minute)

```bash
# Test API health
curl -k https://localhost/api/health
# Expected: {"status":"healthy","time":"2024-01-15T..."}

# Test frontend
curl -k https://localhost/health
# Expected: healthy

# View logs
./logs.sh backend | tail -20
# Should show: Server starting on port 8080
```

## STEP 7: ACCESS APPLICATION

1. **Open your browser:** https://backups.cloudconnect.com

2. **Default Login:**
   - Email: `admin@cloudconnect.com`
   - Password: `ChangeMe123!`

3. **IMMEDIATELY:**
   - Go to Profile > Change Password
   - Create your personal account
   - Logout from admin account

## STEP 8: CONFIGURE AUTOMATED BACKUPS

```bash
# Create backup directory
sudo mkdir -p /backups/database
sudo chown $USER:$USER /backups/database

# Add to crontab
crontab -e

# Add this line (daily backup at 2 AM):
0 2 * * * cd /path/to/backup-manager && ./backup-db.sh > /backups/database/backup.log 2>&1
```

## STEP 9: SETUP SSL AUTO-RENEWAL

```bash
# Test renewal (dry run)
sudo certbot renew --dry-run

# Add renewal to crontab
sudo crontab -e

# Add this line (check twice daily):
0 0,12 * * * certbot renew --quiet --post-hook "cd /path/to/backup-manager && sudo cp /etc/letsencrypt/live/backups.cloudconnect.com/*.pem nginx/ssl/ && docker-compose exec frontend nginx -s reload"
```

## STEP 10: CONFIGURE FIREWALL

```bash
# Enable firewall
sudo ufw enable

# Allow SSH (IMPORTANT - do this first!)
sudo ufw allow 22/tcp

# Allow HTTP/HTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

# Check status
sudo ufw status
```

## PRODUCTION VALIDATION CHECKLIST

Test each item:

### Functional Tests
```bash
# 1. Registration
curl -X POST https://backups.cloudconnect.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test123!@#"}'

# 2. Login  
curl -X POST https://backups.cloudconnect.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test123!@#"}'

# 3. Upload (requires token from login)
curl -X POST https://backups.cloudconnect.com/api/backups \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -F "file=@test-backup.txt"
```

### Security Tests
```bash
# 1. HTTPS redirect
curl -I http://backups.cloudconnect.com
# Should redirect to HTTPS (301)

# 2. Security headers
curl -I https://backups.cloudconnect.com
# Should include: X-Frame-Options, X-Content-Type-Options, etc.

# 3. SSL certificate valid
openssl s_client -connect backups.cloudconnect.com:443 -servername backups.cloudconnect.com
# Should show valid certificate (not self-signed)
```

### Performance Tests
```bash
# 1. Response time
time curl -so /dev/null https://backups.cloudconnect.com
# Should be < 1 second

# 2. Database query performance
docker-compose exec postgres psql -U cloudconnect -d backup_manager -c "EXPLAIN ANALYZE SELECT * FROM projects LIMIT 100;"
# Should be < 100ms
```

## MONITORING COMMANDS

```bash
# Check service status
docker-compose ps

# View real-time logs
./logs.sh

# Check disk space
df -h

# Check memory usage
free -h

# Database size
docker-compose exec postgres psql -U cloudconnect -d backup_manager -c "SELECT pg_size_pretty(pg_database_size('backup_manager'));"

# Active connections
docker-compose exec postgres psql -U cloudconnect -d backup_manager -c "SELECT count(*) FROM pg_stat_activity;"
```

## COMMON MANAGEMENT TASKS

### Restart Services
```bash
# Restart all
./stop.sh && ./start.sh

# Restart specific service
docker-compose restart backend
```

### View Logs
```bash
# All services
./logs.sh

# Specific service
./logs.sh backend
./logs.sh postgres
./logs.sh redis
```

### Backup Database
```bash
# Manual backup
./backup-db.sh
# Creates: backup_YYYYMMDD_HHMMSS.sql
```

### Restore Database
```bash
# Stop services
./stop.sh

# Restore
cat backup_20240115_020000.sql | docker-compose exec -T postgres psql -U cloudconnect backup_manager

# Start services
./start.sh
```

### Update Application
```bash
# Pull new version
tar -xzf cloud-connect-backup-manager-v1.1-production.tar.gz -C /tmp/
cd /tmp/backup-manager

# Backup current installation
./backup-db.sh

# Stop current version
cd /path/to/current/backup-manager
./stop.sh

# Replace with new version
cd /path/to/
mv backup-manager backup-manager.old
mv /tmp/backup-manager .
cd backup-manager

# Copy environment and certificates
cp ../backup-manager.old/.env .
cp -r ../backup-manager.old/nginx/ssl nginx/

# Start new version
./start.sh

# Verify
docker-compose ps
curl -k https://localhost/api/health
```

## ANALYTICS SETUP

### Google Analytics 4

1. **Create GA4 Property:**
   - Go to: https://analytics.google.com
   - Click: Admin > Create Property
   - Name: "Cloud Connect Backup Manager"
   - Choose: Web data stream
   - URL: https://backups.cloudconnect.com

2. **Get Measurement ID:**
   - In GA4: Admin > Data Streams
   - Click your stream
   - Copy Measurement ID (format: G-XXXXXXXXXX)

3. **Add to Application:**
   ```bash
   nano .env
   # Add: GA_MEASUREMENT_ID=G-XXXXXXXXXX
   docker-compose restart frontend
   ```

4. **Verify Tracking:**
   - Visit: https://backups.cloudconnect.com
   - In GA4: Reports > Realtime
   - Should see your visit

### Google Tag Manager

1. **Create GTM Container:**
   - Go to: https://tagmanager.google.com
   - Click: Create Account
   - Container name: "Cloud Connect Backup Manager"
   - Target platform: Web

2. **Get Container ID:**
   - Click: Workspace
   - Copy ID from top (format: GTM-XXXXXXX)

3. **Add to Application:**
   ```bash
   nano .env
   # Add: GTM_ID=GTM-XXXXXXX
   docker-compose restart frontend
   ```

4. **Publish Container:**
   - Click: Submit > Publish
   - Version name: "Initial Setup"

5. **Verify:**
   - Install: Tag Assistant Chrome extension
   - Visit: https://backups.cloudconnect.com
   - Click Tag Assistant icon
   - Should show GTM container firing

## TROUBLESHOOTING

### Issue: "Port 80 already in use"
```bash
# Find process using port
sudo lsof -i :80

# Stop Apache/Nginx
sudo systemctl stop apache2
sudo systemctl stop nginx
```

### Issue: "Cannot connect to database"
```bash
# Check PostgreSQL logs
./logs.sh postgres

# Verify password
cat .env | grep POSTGRES_PASSWORD

# Test connection
docker-compose exec postgres psql -U cloudconnect -d backup_manager
```

### Issue: "SSL certificate error"
```bash
# Check certificate
openssl x509 -in nginx/ssl/cert.pem -text -noout

# Regenerate self-signed
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout nginx/ssl/key.pem \
  -out nginx/ssl/cert.pem \
  -subj "/CN=localhost"

# Restart
docker-compose restart frontend
```

### Issue: "Out of disk space"
```bash
# Clean Docker
docker system prune -a --volumes

# Check volumes
docker volume ls
du -sh /var/lib/docker/volumes/*
```

## SUPPORT

- **Documentation:** README.md, DEPLOYMENT-CHECKLIST.md
- **Email:** support@cloudconnect.com
- **Emergency:** Use backup and rollback procedures

## PRODUCTION GO-LIVE CHECKLIST

Before going live:
- [ ] Domain DNS configured
- [ ] SSL certificates installed (Let's Encrypt)
- [ ] GA_MEASUREMENT_ID configured
- [ ] GTM_ID configured
- [ ] Automated backups configured
- [ ] SSL auto-renewal configured
- [ ] Firewall enabled and configured
- [ ] Default admin password changed
- [ ] All functional tests passed
- [ ] All security tests passed
- [ ] Monitoring configured
- [ ] Documentation reviewed

**Deployment Time: 10 minutes**
**Total Setup Time: ~30 minutes including verification**
